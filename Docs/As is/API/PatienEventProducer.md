# Kafka Point - Регистрация нового пациента

## Назначение

Событие публикуется сервисом patient-service при успешном создании новой карточки пациента в базе данных и после создания биллингового аккаунта через gRPC. Событие уведомляет заинтересованные сервисы о появлении нового пользователя.
## Общие сведения
**Producer:** patient-service

**Topic:** patient

**Protocol:** TCP

**Format message:** Protobuf 

## Структура сообщения (Схема Protobuf)
Описание полей файла PatientEvent.proto:

| Поле      |Тип|Обязательность| Описание                                                    |
|:----------|:---|:---|:------------------------------------------------------------|
| patientId |string|Да| Уникальный идентификатор пациента (UUID)                    |
| name      |string|Да| ФИО пациента                                                |
| email     |string|Да| Электронная почта пациента                                  |
| eventType |string|Да| Тип события: PATIENT_CREATED|


## Алгоритм публикации
Публикация происходит в рамках метода createPatient класса PatientService.

1. Триггер: Успешное завершение бизнес-логики (создание/изменение записи в БД и успешный gRPC вызов).


2. Формирование данных: Сервис извлекает актуальные данные сущности из БД.


3. Сборка сообщения: Заполнение полей PatientEvent. Установка типа события в поле event_type.


4. Сериализация: Трансформация объекта в массив байтов (ByteArraySerializer).


5. Отправка: Публикация в топик patient.

### Обработка исключительных ситуаций
Согласно коду KafkaProducer.java, используется блок try-catch, который поглощает любые ошибки при взаимодействии с брокером:

Сценарий: Брокер Kafka недоступен или возник таймаут.

Действие: Ошибка записывается в лог приложения (Error sending PatientCreated event).

Результат для клиента: Клиент получает успешный ответ 200 OK, данные в БД сохранены, gRPC вызов выполнен. Сообщение в Kafka считается потерянным (Data Inconsistency).

## Пример сообщения (JSON до сериализации)
~~~ 

{
"patientId": "550e8400-e29b-41d4-a716-446655440000",
"name": "John Doe",
"email": "john.doe@example.com",
"event_type": "PATIENT_CREATED"
}   
~~~ 
